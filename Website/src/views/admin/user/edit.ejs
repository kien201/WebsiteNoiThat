<%- include('../../layouts/adminHeader') -%>
    <main class="px-5 py-3">
        <h1 class="mb-3">Cập nhật người dùng</h1>
        <form action="/admin/user/edit/<%=userInfo.id%>" method="post">

            <% errors.forEach(err => { %>
                <li class="text-danger mb-2"><%= err.msg %></li>
            <% }); %>
            
            <div class="row mb-3">
                <label for="fullName" class="col-sm-2 col-form-label">Tên</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" name="fullName" id="fullName" value="<%=userInfo.fullName%>" required>
                </div>
            </div>
            <div class="row mb-3">
                <label for="email" class="col-sm-2 col-form-label">Email</label>
                <div class="col-sm-10">
                    <input type="email" class="form-control" name="email" id="email" value="<%=userInfo.email%>" required>
                </div>
            </div>
            <div class="row mb-3">
                <label for="phoneNumber" class="col-sm-2 col-form-label">SĐT</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" name="phoneNumber" id="phoneNumber" value="<%=userInfo.phoneNumber%>" required>
                </div>
            </div>
            <div class="row mb-3">
                <label for="DoB" class="col-sm-2 col-form-label">Ngày sinh</label>
                <div class="col-sm-10">
                    <input type="date" class="form-control" name="DoB" id="DoB" value="<%=userInfo.DoB%>" required>
                </div>
            </div>
            <fieldset class="row mb-3">
                <legend class="col-form-label col-sm-2 pt-0">Giới tính</legend>
                <div class="col-sm-10 row row-cols-auto mx-0">
                    <% userGendersForDisplay.forEach(function (gender) { %>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="gender" value="<%=gender.value%>" id="gender<%=gender.value%>" <%= gender.value === userInfo.gender ? 'checked' : '' %> />
                            <label class="form-check-label" for="gender<%=gender.value%>">
                                <%=gender.text%>
                            </label>
                        </div>
                    <% }) %>
                </div>
            </fieldset>
            <div class="row mb-3">
                <label for="address" class="col-sm-2 col-form-label">Địa chỉ</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" name="address" id="address" value="<%=userInfo.address%>">
                </div>
            </div>
            <div class="row mb-3">
                <label for="role" class="col-sm-2 col-form-label">Chức vụ</label>
                <div class="col-sm-10">
                    <select class="form-select" name="role" id="role">
                        <% userRolesForDisplay.forEach(function (role) { %>
                            <option <%= role.value === userInfo.role ? 'selected' : '' %> value="<%=role.value%>"><%=role.text%></option>
                        <% }) %>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Cập nhật</button>
            <button type="button" class="btn btn-info ms-2" onclick="Resetpass('<%=userInfo.id%>')">Đặt lại mật khẩu</button>
            <a class="btn btn-secondary ms-2" href="/admin/user">Trở về</a>
        </form>
    </main>
    <% if (locals.editSuccess) { %>
        <script>
            alert('Cập nhật thành công')
            window.location = '/admin/user'
        </script>
    <% } %>
    <script>
        function Resetpass(id) {
            if (confirm("Đặt lại mật khẩu thành '123'. Đồng ý ?")) {
                fetch('/admin/user/resetpass/'+id, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                    .then((response) => response.json())
                    .then((data) => {
                        alert(data.message);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }
        }
    </script>
<%- include('../../layouts/adminFooter') -%>
